
const char fingerprint[] PROGMEM = "30 82 01 0a 02 82 01 01 00 ad 2a 2f 8f 86 44 35 13 d8 e3 f8 0c a9 53 de 70 ff b9 36 e9 97 79 03 d9 7e 08 6f 84 ca d2 dd 81 1c fa 2f d5 1f 6d a6 bb 6c ad 55 5b 7e ae d5 23 70 2a d7 b2 fe 37 27 dc c6 ee e9 f1 9c 06 ce 37 94 59 0c fb c8 d2 4d ed 69 95 d5 c4 9e bb f4 10 67 c9 7f 26 a2 8b c5 2a 84 39 6c c4 a0 78 02 8f a6 49 ec 3d d9 92 e1 d7 c9 df a7 41 c2 72 ec 94 f2 1f d4 33 3c 45 ac 26 09 23 ed eb f7 00 90 c0 8e d3 78 9b 50 d3 cd 3d 04 1e ac ff eb 01 d0 b4 95 10 a1 1d ed 2c ca 12 39 72 1a b3 20 87 bb 6e 39 3b 75 2d 93 05 fb ff f3 d4 3b a8 2d 36 c4 88 0a 2e e9 21 c4 9c 30 19 a2 be bb 4d a3 28 45 76 8f 2f fc b4 78 9c c9 64 07 24 ad 90 9c a7 21 e8 f5 2c be 0e 64 a5 28 6b 0e d1 ae d3 e4 c6 34 48 83 94 eb 55 c8 2d 83 02 11 58 97 0e 9f 07 a6 ef 0a 19 07 9d fc 60 ff a2 c7 e2 70 ca 85 c2 1d 31 02 03 01 00 01";
//Link to read data from https://jsonplaceholder.typicode.com/comments?postId=7
//Web/Server address to read/write from 

const char *host = "postman-echo.com";
const int httpsPort = 443;  //HTTPS= 443 and HTTP = 80

//SHA1 finger print of certificate use web browser to view and copy
const char fingerprint[] PROGMEM = "A6 5A 41 2C 0E DC FF C3 16 E8 57 E9 F2 C3 11 D2 71 58 DF D9";
//=======================================================================
//                    Power on setup
//=======================================================================


//=======================================================================
//                    Main Program Loop
//=======================================================================
void loop() {
  WiFiClientSecure httpsClient;    //Declare object of class WiFiClient

  Serial.println(host);

  Serial.printf("Using fingerprint '%s'\n", fingerprint);
  httpsClient.setFingerprint(fingerprint);
  httpsClient.setTimeout(15000); // 15 Seconds
  delay(1000);
  
  Serial.print("HTTPS Connecting");
  int r=0; //retry counter
  while((!httpsClient.connect(host, httpsPort)) && (r < 30)){
      delay(100);
      Serial.print(".");
      r++;
  }
  if(r==30) {
    Serial.println("Connection failed");
  }
  else {
    Serial.println("Connected to web");
  }
  
  String getData, Link;
  
  //POST Data
  Link = "/post";

  Serial.print("requesting URL: ");
  Serial.println(host);
  /*
   POST /post HTTP/1.1
   Host: postman-echo.com
   Content-Type: application/x-www-form-urlencoded
   Content-Length: 13
  
   say=Hi&to=Mom
    
   */

  httpsClient.print(String("POST ") + Link + " HTTP/1.1\r\n" +
               "Host: " + host + "\r\n" +
               "Content-Type: application/x-www-form-urlencoded"+ "\r\n" +
               "Content-Length: 13" + "\r\n\r\n" +
               "say=Hi&to=Mom" + "\r\n" +
               "Connection: close\r\n\r\n");

  Serial.println("request sent");
                  
  while (httpsClient.connected()) {
    String line = httpsClient.readStringUntil('\n');
    if (line == "\r") {
      Serial.println("headers received");
      break;
    }
  }

  Serial.println("reply was:");
  Serial.println("==========");
  String line;
  while(httpsClient.available()){        
    line = httpsClient.readStringUntil('\n');  //Read Line by Line
    Serial.println(line); //Print response
  }
  Serial.println("==========");
  Serial.println("closing connection");
    
  delay(2000);  //POST Data at every 2 seconds
}
//=======================================================================